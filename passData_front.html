{{Front}}
<br>


<div id="in">
	<textarea placeholder="Type your code here..."></textarea>
	<div id="kbd">
		<button onclick="insert('()')">()</button>
		<button onclick="insert('{}')">{}</button>
		<button onclick="insert('[]')">[]</button>
		<button onclick="insert('&lt;&gt;')">&lt;&gt;</button>
		<button onclick="insert('<<')">⇤</button>
		<button onclick="insert('>>')">⇥</button>
	</div>
</div>


<script>
	sessionStorage.clear()

	var ta = document.querySelector("textarea")
	ta.addEventListener("input", e => sessionStorage.setItem("userAnswer", ta.value.trim()))

</script>


<style>
	#in {
		display: flex;
		flex-direction: column;
		justify-content: end;
		position: fixed;
		bottom: 0;
		left: 0;
		right: 0;
		z-index: 9999;
	}

	#kbd {
		display: flex;
		justify-content: space-around;
	}

	#kbd button {
		font-size: 18px;
		padding: 18px;
		border: 1px solid #aaa;
		border-radius: 5px;
		background: white;
		flex: 1;
		margin: 0 4px;
	}

	textarea {
		width: 100%;
		height: 150px;
		font-family: monospace;
		font-size: 16px;
	}
</style>




<script>


	function shiftRange(text, start, end, shiftDir = "right") {
		var linesWithinRange = getLinesWithinRange(text, start, end)
		var beforeText = text.substring(0, linesWithinRange[0].start)
		var afterText = text.substring(linesWithinRange[linesWithinRange.length - 1].end + 1)
		var centerLines = linesWithinRange.map(line => {
			console.log(shiftDir)
			if (shiftDir === "right" || shiftDir === "r") {
				return { shift: 4, substring: "    " + line.substring }
			} else {
				var i = -1
				while (true) {
					i++;
					if (line.substring[i] !== " " || i === 4) break
				}
				return { shift: -i, substring: line.substring.substring(i) }
			}

		})
		var centerText = centerLines.map(l => l.substring).join("")
		console.log("!!!!!!!!!!!!!centerLines: " + JSON.stringify(centerLines))
		console.log("!!!!!!!!!!!!!centerText: " + centerText)

		var combinedText = beforeText + centerText + afterText
		console.log(`###before:${beforeText}\n###after:${afterText}\n###center:${centerText}`)
		console.log(`#####combined:${combinedText}`)



		console.log(`#####centerLines:` + centerLines)
		return {
			newStart: centerLines[0].shift,
			newEnd: centerLines[centerLines.length] === undefined ? centerLines[0].shift : centerLines[centerLines.length].shift,
			combinedText
		}
	}
	function getLinesWithinRange(text, start, end) {
		let lines = [...text.matchAll(/(^.*(?:\n|$))/gm)].map(m => ({ substring: m[[0]], start: m.index }))
		lines = lines.map((line, i) => ({ ...line, end: lines[i + 1] === undefined ? line.start + line.substring.length : lines[i + 1].start - 1 }))
		linesWithinRange = lines.filter(line => end >= line.start && start <= line.end)
		return linesWithinRange
	}


	function insert(str) {
		const input = document.querySelector('textarea');
		const start = input.selectionStart;
		const end = input.selectionEnd;
		const text = input.value;

		if (str === ">>") {
			shiftObj = shiftRange(text, start, end, "r")
			input.value = shiftObj.combinedText
			input.selectionStart = start + shiftObj.newStart;
			input.selectionEnd = end + shiftObj.newEnd;
		} else if (str === "<<") {
			shiftObj = shiftRange(text, start, end, "l")
			input.value = shiftObj.combinedText
			input.selectionStart = start + shiftObj.newStart;
			input.selectionEnd = end + shiftObj.newEnd;
		} else {
			input.value = text.slice(0, start) + str + text.slice(end);
			input.selectionStart = input.selectionEnd = start + str.length;
		}
		input.focus();
	}
</script>